#!/sbin/sh

export ZIPARG2="$2"

my_print() {
	printf '%s\n' "ui_print $1" >> "/proc/self/fd/$ZIPARG2"
}

mountpoint -q /data || mount /data

before_dalvik="$(du -s /data/dalvik-cache | cut -f1)"
before_resource="$(du -s /data/resource-cache | cut -f1)"
before_cache="$(du -s /data/cache | cut -f1)"

my_print " "

my_print "Wiping /data/dalvik-cache..."
rm -rf /data/dalvik-cache/*
my_print "Done."

my_print "Wiping /data/resource-cache..."
rm -rf /data/resource-cache/*
my_print "Done."

my_print "Wiping /data/cache..."
rm -rf /data/cache/*
my_print "Done."

after_dalvik="$(du -s /data/dalvik-cache | cut -f1)"
after_resource="$(du -s /data/resource-cache | cut -f1)"
after_cache="$(du -s /data/cache | cut -f1)"

my_print " "

my_print "dalvik-cache: ${before_dalvik}b -> ${after_dalvik}b"
my_print "resource-cache: ${before_resource}b -> ${after_resource}b"
my_print "cache: ${before_cache}b -> ${after_cache}b"

my_print " "

my_print "Dirty-flash wipe complete!"

my_print " "

exit 0
